---
import Base from '../../layouts/Base.astro';

// Get all news articles
const allNews = await Astro.glob('./**/*.md');
const news = allNews
  .filter(post => post.frontmatter?.title)
  .sort((a, b) => new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime());

const categories = ['All', 'Research', 'Legal', 'Industry', 'Buzz'];

const categoryColors: Record<string, string> = {
  'Research': 'text-blue-700 bg-blue-50 border-blue-200',
  'Legal': 'text-red-700 bg-red-50 border-red-200',
  'Industry': 'text-purple-700 bg-purple-50 border-purple-200',
  'Buzz': 'text-orange-700 bg-orange-50 border-orange-200',
};

function getFreshness(dateStr: string) {
  const now = new Date();
  const d = new Date(dateStr);
  const days = Math.floor((now.getTime() - d.getTime()) / (1000 * 60 * 60 * 24));
  if (days > 90) return { label: 'Archived', class: 'text-gray-500 bg-gray-50' };
  if (days > 30) return { label: 'Aging', class: 'text-amber-600 bg-amber-50' };
  return { label: 'Current', class: 'text-green-600 bg-green-50' };
}
---
<Base title="Peptide News" description="Stay up to date with the latest peptide research, FDA regulations, legal developments, and industry trends.">

  <!-- Hero -->
  <section class="bg-gradient-to-br from-surface-dark via-primary-dark to-surface-dark py-16">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 text-center">
      <span class="inline-block px-4 py-1.5 text-xs font-bold text-primary-light bg-primary/20 rounded-full mb-4 uppercase tracking-wider">
        Latest Updates
      </span>
      <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-4">Peptide News</h1>
      <p class="text-lg text-gray-300 max-w-2xl mx-auto">
        Breaking research, regulatory changes, and industry developments in the world of peptides.
      </p>
    </div>
  </section>

  <!-- Category Filter -->
  <section class="border-b border-gray-200 bg-white sticky top-16 z-40">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="flex items-center gap-2 py-3 overflow-x-auto" id="category-filters">
        {categories.map(cat => (
          <button
            data-category={cat}
            class={`px-4 py-1.5 text-sm font-medium rounded-full border transition-colors whitespace-nowrap ${cat === 'All' ? 'bg-primary text-white border-primary' : 'bg-white text-text-muted border-gray-200 hover:border-primary hover:text-primary'}`}
          >
            {cat}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- News Grid + Sidebar -->
  <section class="py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:flex lg:gap-10">
      <!-- Main Grid -->
      <div class="lg:flex-1 min-w-0">
        {news.length === 0 ? (
          <div class="text-center py-20">
            <p class="text-xl text-text-muted">News section launching soon. Check back for the latest peptide developments.</p>
          </div>
        ) : (
          <div class="grid md:grid-cols-2 gap-6" id="news-grid">
            {news.map(post => {
              const fresh = getFreshness(post.frontmatter.date);
              const catColor = categoryColors[post.frontmatter.category] || 'text-primary bg-primary/10 border-primary/20';
              const date = new Date(post.frontmatter.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
              const url = post.url;
              return (
                <a href={url} data-cat={post.frontmatter.category} class="news-card group block bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-lg hover:border-primary/30 transition-all hover:-translate-y-0.5">
                  {post.frontmatter.image && (
                    <div class="aspect-video overflow-hidden">
                      <img src={post.frontmatter.image} alt={post.frontmatter.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy" />
                    </div>
                  )}
                  <div class="p-5">
                    <div class="flex items-center gap-2 mb-3">
                      <span class={`px-2 py-0.5 text-xs font-bold rounded-full ${catColor}`}>
                        {post.frontmatter.category}
                      </span>
                      <span class={`px-2 py-0.5 text-xs font-medium rounded-full ${fresh.class}`}>
                        {fresh.label}
                      </span>
                      <span class="text-xs text-text-muted ml-auto">{date}</span>
                    </div>
                    <h2 class="text-lg font-bold text-text group-hover:text-primary transition-colors mb-2 line-clamp-2">
                      {post.frontmatter.title}
                    </h2>
                    <p class="text-sm text-text-muted line-clamp-3">
                      {post.frontmatter.description}
                    </p>
                  </div>
                </a>
              );
            })}
          </div>
        )}
      </div>

      <!-- Sidebar -->
      <aside class="hidden lg:block lg:w-72 shrink-0 mt-6 lg:mt-0">
        <div class="sticky top-24 space-y-6">
          <!-- About News Section -->
          <div class="bg-white rounded-2xl border border-gray-200 p-5 shadow-sm">
            <h3 class="text-sm font-bold text-text uppercase tracking-wide mb-3">About Our News</h3>
            <p class="text-xs text-text-muted leading-relaxed mb-3">
              We track the latest peptide research, regulatory changes, and community trends so you don't have to.
            </p>
            <div class="space-y-2 text-xs text-text-muted">
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500 shrink-0"></span>
                <span><strong class="text-text">Current</strong> — published within 30 days</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-amber-500 shrink-0"></span>
                <span><strong class="text-text">Aging</strong> — 31-90 days old</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-gray-400 shrink-0"></span>
                <span><strong class="text-text">Archived</strong> — over 90 days old</span>
              </div>
            </div>
          </div>

          <!-- News Categories -->
          <div class="bg-white rounded-2xl border border-gray-200 p-5 shadow-sm">
            <h3 class="text-sm font-bold text-text uppercase tracking-wide mb-3">Categories</h3>
            <div class="space-y-3">
              <div class="flex items-center gap-2">
                <span class="w-2.5 h-2.5 rounded-full bg-blue-500 shrink-0"></span>
                <span class="text-sm font-medium text-text">Research</span>
                <span class="text-xs text-text-muted ml-auto">Studies &amp; trials</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-2.5 h-2.5 rounded-full bg-red-500 shrink-0"></span>
                <span class="text-sm font-medium text-text">Legal</span>
                <span class="text-xs text-text-muted ml-auto">FDA &amp; regulation</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-2.5 h-2.5 rounded-full bg-purple-500 shrink-0"></span>
                <span class="text-sm font-medium text-text">Industry</span>
                <span class="text-xs text-text-muted ml-auto">Market &amp; clinics</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-2.5 h-2.5 rounded-full bg-orange-500 shrink-0"></span>
                <span class="text-sm font-medium text-text">Buzz</span>
                <span class="text-xs text-text-muted ml-auto">Trends &amp; community</span>
              </div>
            </div>
          </div>

          <!-- Popular Guides -->
          <div class="bg-white rounded-2xl border border-gray-200 p-5 shadow-sm">
            <h3 class="text-sm font-bold text-text uppercase tracking-wide mb-3">Popular Guides</h3>
            <div class="space-y-3">
              <a href="/articles/retatrutide-complete-guide" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
                Retatrutide: The Triple Agonist Guide
              </a>
              <a href="/articles/bpc-157-complete-guide" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
                BPC-157 Complete Guide
              </a>
              <a href="/articles/peptide-bloodwork-guide" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
                Peptide Bloodwork Guide
              </a>
              <a href="/articles/how-to-read-peptide-coa" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
                How to Read a COA
              </a>
              <a href="/articles/peptide-stacking-guide" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
                Complete Stacking Guide
              </a>
            </div>
            <a href="/articles" class="block mt-4 text-xs font-bold text-primary hover:underline">
              View all guides →
            </a>
          </div>

          <!-- CTA -->
          <div class="bg-gradient-to-br from-surface-dark to-primary-dark rounded-2xl p-5 text-center">
            <p class="text-sm font-bold text-white mb-2">New to Peptides?</p>
            <p class="text-xs text-gray-300 mb-3">Start with the fundamentals.</p>
            <a href="/articles/what-are-peptides-beginners-guide" class="inline-block px-4 py-2 text-xs font-bold bg-primary text-white rounded-lg hover:bg-primary-light transition-colors">
              Read Beginner's Guide
            </a>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <script>
    document.querySelectorAll('#category-filters button').forEach(btn => {
      btn.addEventListener('click', () => {
        const cat = btn.getAttribute('data-category');
        // Update button styles
        document.querySelectorAll('#category-filters button').forEach(b => {
          b.className = 'px-4 py-1.5 text-sm font-medium rounded-full border transition-colors whitespace-nowrap bg-white text-text-muted border-gray-200 hover:border-primary hover:text-primary';
        });
        btn.className = 'px-4 py-1.5 text-sm font-medium rounded-full border transition-colors whitespace-nowrap bg-primary text-white border-primary';
        // Filter cards
        document.querySelectorAll('.news-card').forEach(card => {
          if (cat === 'All' || card.getAttribute('data-cat') === cat) {
            card.style.display = '';
          } else {
            card.style.display = 'none';
          }
        });
      });
    });
  </script>
</Base>
