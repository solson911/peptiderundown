---
import Base from './Base.astro';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    date: string;
    category?: string;
    author?: string;
    tags?: string[];
    image?: string;
    source?: string;
    sourceUrl?: string;
  };
}

const { frontmatter } = Astro.props;
const formattedDate = new Date(frontmatter.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
const now = new Date();
const articleDate = new Date(frontmatter.date);
const daysOld = Math.floor((now.getTime() - articleDate.getTime()) / (1000 * 60 * 60 * 24));

let freshness = 'fresh';
let freshnessLabel = 'Current';
let freshnessColor = 'text-green-600 bg-green-50 border-green-200';
if (daysOld > 90) {
  freshness = 'archived';
  freshnessLabel = 'Archived';
  freshnessColor = 'text-gray-500 bg-gray-50 border-gray-200';
} else if (daysOld > 30) {
  freshness = 'aging';
  freshnessLabel = 'Aging';
  freshnessColor = 'text-amber-600 bg-amber-50 border-amber-200';
}

const categoryColors: Record<string, string> = {
  'Research': 'text-blue-700 bg-blue-50',
  'Legal': 'text-red-700 bg-red-50',
  'Industry': 'text-purple-700 bg-purple-50',
  'Buzz': 'text-orange-700 bg-orange-50',
};
const catColor = categoryColors[frontmatter.category || ''] || 'text-primary bg-primary/10';
---
<Base title={frontmatter.title} description={frontmatter.description}>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 py-12">
    <article>
      <!-- Breadcrumb -->
      <nav class="flex items-center gap-2 text-sm text-text-muted mb-6">
        <a href="/" class="hover:text-primary transition-colors">Home</a>
        <span>/</span>
        <a href="/news" class="hover:text-primary transition-colors">News</a>
        <span>/</span>
        <span class="text-text">{frontmatter.category}</span>
      </nav>

      <!-- Hero Image -->
      {frontmatter.image && (
        <div class="mb-8 -mx-4 sm:mx-0">
          <img src={frontmatter.image} alt={frontmatter.title} class="w-full rounded-none sm:rounded-2xl shadow-lg object-cover max-h-80" loading="eager" />
        </div>
      )}

      <!-- Article Header -->
      <header class="mb-8">
        <div class="flex flex-wrap items-center gap-2 mb-4">
          {frontmatter.category && (
            <span class={`inline-block px-3 py-1 text-xs font-bold rounded-full uppercase tracking-wide ${catColor}`}>
              {frontmatter.category}
            </span>
          )}
          <span class={`inline-block px-3 py-1 text-xs font-medium rounded-full border ${freshnessColor}`}>
            {freshnessLabel}
          </span>
        </div>
        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-extrabold leading-tight text-text mb-4">
          {frontmatter.title}
        </h1>
        {frontmatter.description && (
          <p class="text-lg text-text-muted leading-relaxed mb-4">{frontmatter.description}</p>
        )}
        <div class="flex flex-wrap items-center gap-4 text-sm text-text-muted border-t border-gray-200 pt-4">
          <span>By <strong class="text-text">{frontmatter.author || 'PeptideRundown Team'}</strong></span>
          <span>·</span>
          <time datetime={frontmatter.date}>{formattedDate}</time>
          {frontmatter.source && (
            <>
              <span>·</span>
              <span>Source: {frontmatter.sourceUrl ? (
                <a href={frontmatter.sourceUrl} target="_blank" rel="noopener" class="text-primary hover:underline">{frontmatter.source}</a>
              ) : frontmatter.source}</span>
            </>
          )}
        </div>
      </header>

      <!-- Aging Banner -->
      {freshness === 'aging' && (
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-8 text-sm text-amber-800">
          <strong>Note:</strong> This news article is over 30 days old. Some information may have been updated since publication. Check our <a href="/news" class="text-amber-900 underline">latest news</a> for current developments.
        </div>
      )}
      {freshness === 'archived' && (
        <div class="bg-gray-100 border border-gray-200 rounded-xl p-4 mb-8 text-sm text-gray-600">
          <strong>Archived:</strong> This article is over 90 days old and has been archived. The information may be outdated. See our <a href="/news" class="text-gray-800 underline">latest news</a> for current coverage.
        </div>
      )}

      <!-- Content -->
      <div class="prose prose-lg prose-slate max-w-none
        prose-p:leading-relaxed prose-p:mb-5
        prose-headings:font-bold prose-headings:text-text
        prose-h2:text-2xl prose-h2:mt-10 prose-h2:mb-4
        prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
        prose-li:mb-2
        prose-a:text-primary prose-a:no-underline hover:prose-a:underline
        prose-strong:text-text
        prose-blockquote:border-primary prose-blockquote:bg-primary/5 prose-blockquote:rounded-r-lg prose-blockquote:py-2 prose-blockquote:px-5
        prose-img:rounded-xl prose-img:shadow-lg
        prose-hr:hidden">
        <slot />
      </div>

      <!-- Tags -->
      {frontmatter.tags && frontmatter.tags.length > 0 && (
        <div class="mt-10 pt-6 border-t border-gray-200">
          <div class="flex flex-wrap gap-2">
            {frontmatter.tags.map((tag: string) => (
              <span class="px-3 py-1 text-xs font-medium text-text-muted bg-gray-100 rounded-full">
                #{tag}
              </span>
            ))}
          </div>
        </div>
      )}

      <!-- Back to News -->
      <div class="mt-10 pt-6 border-t border-gray-200">
        <a href="/news" class="inline-flex items-center gap-2 text-sm font-bold text-primary hover:underline">
          ← Back to all news
        </a>
      </div>
    </article>
  </div>
</Base>
