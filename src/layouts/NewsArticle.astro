---
import Base from './Base.astro';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    date: string;
    category?: string;
    author?: string;
    tags?: string[];
    image?: string;
    source?: string;
    sourceUrl?: string;
  };
}

const { frontmatter } = Astro.props;
const formattedDate = new Date(frontmatter.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
const now = new Date();
const articleDate = new Date(frontmatter.date);
const daysOld = Math.floor((now.getTime() - articleDate.getTime()) / (1000 * 60 * 60 * 24));

let freshness = 'fresh';
let freshnessLabel = 'Current';
let freshnessColor = 'text-green-600 bg-green-50 border-green-200';
if (daysOld > 90) {
  freshness = 'archived';
  freshnessLabel = 'Archived';
  freshnessColor = 'text-gray-500 bg-gray-50 border-gray-200';
} else if (daysOld > 30) {
  freshness = 'aging';
  freshnessLabel = 'Aging';
  freshnessColor = 'text-amber-600 bg-amber-50 border-amber-200';
}

const categoryColors: Record<string, string> = {
  'Research': 'text-blue-700 bg-blue-50',
  'Legal': 'text-red-700 bg-red-50',
  'Industry': 'text-purple-700 bg-purple-50',
  'Buzz': 'text-orange-700 bg-orange-50',
};
const catColor = categoryColors[frontmatter.category || ''] || 'text-primary bg-primary/10';
---
<Base title={frontmatter.title} description={frontmatter.description}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-12 md:flex md:gap-8">
    <!-- Main Content -->
    <article class="md:flex-1 min-w-0">
      <!-- Breadcrumb -->
      <nav class="flex items-center gap-2 text-sm text-text-muted mb-6">
        <a href="/" class="hover:text-primary transition-colors">Home</a>
        <span>/</span>
        <a href="/news" class="hover:text-primary transition-colors">News</a>
        <span>/</span>
        <span class="text-text">{frontmatter.category}</span>
      </nav>

      <!-- Hero Image -->
      {frontmatter.image && (
        <div class="mb-8 -mx-4 sm:mx-0">
          <img src={frontmatter.image} alt={frontmatter.title} class="w-full rounded-none sm:rounded-2xl shadow-lg object-cover max-h-80" loading="eager" />
        </div>
      )}

      <!-- Article Header -->
      <header class="mb-8">
        <div class="flex flex-wrap items-center gap-2 mb-4">
          {frontmatter.category && (
            <span class={`inline-block px-3 py-1 text-xs font-bold rounded-full uppercase tracking-wide ${catColor}`}>
              {frontmatter.category}
            </span>
          )}
          <span class={`inline-block px-3 py-1 text-xs font-medium rounded-full border ${freshnessColor}`}>
            {freshnessLabel}
          </span>
        </div>
        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-extrabold leading-tight text-text mb-4">
          {frontmatter.title}
        </h1>
        {frontmatter.description && (
          <p class="text-lg text-text-muted leading-relaxed mb-4">{frontmatter.description}</p>
        )}
        <div class="flex flex-wrap items-center gap-4 text-sm text-text-muted border-t border-gray-200 pt-4">
          <span>By <strong class="text-text">{frontmatter.author || 'PeptideRundown Team'}</strong></span>
          <span>·</span>
          <time datetime={frontmatter.date}>{formattedDate}</time>
          {frontmatter.source && (
            <>
              <span>·</span>
              <span>Source: {frontmatter.sourceUrl ? (
                <a href={frontmatter.sourceUrl} target="_blank" rel="noopener" class="text-primary hover:underline">{frontmatter.source}</a>
              ) : frontmatter.source}</span>
            </>
          )}
        </div>
      </header>

      <!-- Aging Banner -->
      {freshness === 'aging' && (
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-8 text-sm text-amber-800">
          <strong>Note:</strong> This news article is over 30 days old. Some information may have been updated since publication. Check our <a href="/news" class="text-amber-900 underline">latest news</a> for current developments.
        </div>
      )}
      {freshness === 'archived' && (
        <div class="bg-gray-100 border border-gray-200 rounded-xl p-4 mb-8 text-sm text-gray-600">
          <strong>Archived:</strong> This article is over 90 days old and has been archived. The information may be outdated. See our <a href="/news" class="text-gray-800 underline">latest news</a> for current coverage.
        </div>
      )}

      <!-- Content -->
      <div class="prose prose-lg prose-slate max-w-none
        prose-p:leading-relaxed prose-p:mb-5
        prose-headings:font-bold prose-headings:text-text
        prose-h2:text-2xl prose-h2:mt-10 prose-h2:mb-4
        prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
        prose-li:mb-2
        prose-a:text-primary prose-a:no-underline hover:prose-a:underline
        prose-strong:text-text
        prose-blockquote:border-primary prose-blockquote:bg-primary/5 prose-blockquote:rounded-r-lg prose-blockquote:py-2 prose-blockquote:px-5
        prose-img:rounded-xl prose-img:shadow-lg
        prose-hr:hidden">
        <slot />
      </div>

      <!-- Prominent Source Link -->
      {frontmatter.source && (
        <div class="mt-10 bg-gradient-to-r from-primary/5 to-transparent border border-primary/20 rounded-xl p-5">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0">
              <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
              </svg>
            </div>
            <div>
              <p class="text-sm font-bold text-text">Original Source</p>
              {frontmatter.sourceUrl ? (
                <a href={frontmatter.sourceUrl} target="_blank" rel="noopener" class="text-sm text-primary hover:underline font-medium">
                  {frontmatter.source} →
                </a>
              ) : (
                <p class="text-sm text-text-muted">{frontmatter.source}</p>
              )}
            </div>
          </div>
        </div>
      )}

      <!-- Tags -->
      {frontmatter.tags && frontmatter.tags.length > 0 && (
        <div class="mt-8 pt-6 border-t border-gray-200">
          <div class="flex flex-wrap gap-2">
            {frontmatter.tags.map((tag: string) => (
              <span class="px-3 py-1 text-xs font-medium text-text-muted bg-gray-100 rounded-full">
                #{tag}
              </span>
            ))}
          </div>
        </div>
      )}

      <!-- Back to News -->
      <div class="mt-8 pt-6 border-t border-gray-200">
        <a href="/news" class="inline-flex items-center gap-2 text-sm font-bold text-primary hover:underline">
          ← Back to all news
        </a>
      </div>
    </article>

    <!-- Sidebar -->
    <aside class="w-full md:w-64 shrink-0 mt-10 md:mt-0">
      <div class="md:sticky md:top-24 space-y-6">
        <!-- Article Info Card -->
        <div class="bg-white rounded-2xl border border-gray-200 p-5 shadow-sm">
          <h3 class="text-sm font-bold text-text uppercase tracking-wide mb-3">Article Info</h3>
          {frontmatter.category && (
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xs text-text-muted">Category:</span>
              <span class={`px-2 py-0.5 text-xs font-bold rounded-full ${catColor}`}>{frontmatter.category}</span>
            </div>
          )}
          <div class="flex items-center gap-2 mb-2">
            <span class="text-xs text-text-muted">Published:</span>
            <span class="text-xs font-medium text-text">{formattedDate}</span>
          </div>
          <div class="flex items-center gap-2 mb-2">
            <span class="text-xs text-text-muted">Status:</span>
            <span class={`px-2 py-0.5 text-xs font-medium rounded-full border ${freshnessColor}`}>{freshnessLabel}</span>
          </div>
          {frontmatter.source && (
            <div class="flex items-center gap-2">
              <span class="text-xs text-text-muted">Source:</span>
              {frontmatter.sourceUrl ? (
                <a href={frontmatter.sourceUrl} target="_blank" rel="noopener" class="text-xs font-medium text-primary hover:underline">{frontmatter.source} ↗</a>
              ) : (
                <span class="text-xs font-medium text-text">{frontmatter.source}</span>
              )}
            </div>
          )}
        </div>

        <!-- News Categories -->
        <div class="bg-white rounded-2xl border border-gray-200 p-5 shadow-sm">
          <h3 class="text-sm font-bold text-text uppercase tracking-wide mb-3">News Categories</h3>
          <div class="space-y-2">
            <a href="/news" class="flex items-center justify-between text-sm text-text-muted hover:text-primary transition-colors">
              <span>All News</span>
              <span class="text-xs">→</span>
            </a>
            <a href="/news" class="flex items-center gap-2 text-sm text-text-muted hover:text-blue-700 transition-colors">
              <span class="w-2 h-2 rounded-full bg-blue-500"></span>
              Research
            </a>
            <a href="/news" class="flex items-center gap-2 text-sm text-text-muted hover:text-red-700 transition-colors">
              <span class="w-2 h-2 rounded-full bg-red-500"></span>
              Legal &amp; Compliance
            </a>
            <a href="/news" class="flex items-center gap-2 text-sm text-text-muted hover:text-purple-700 transition-colors">
              <span class="w-2 h-2 rounded-full bg-purple-500"></span>
              Industry
            </a>
            <a href="/news" class="flex items-center gap-2 text-sm text-text-muted hover:text-orange-700 transition-colors">
              <span class="w-2 h-2 rounded-full bg-orange-500"></span>
              Buzz &amp; Trends
            </a>
          </div>
        </div>

        <!-- Related Guides -->
        <div class="bg-white rounded-2xl border border-gray-200 p-5 shadow-sm">
          <h3 class="text-sm font-bold text-text uppercase tracking-wide mb-3">Popular Guides</h3>
          <div class="space-y-3">
            <a href="/articles/retatrutide-complete-guide" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
              Retatrutide: The Triple Agonist Guide
            </a>
            <a href="/articles/bpc-157-complete-guide" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
              BPC-157 Complete Guide
            </a>
            <a href="/articles/semaglutide-weight-loss-guide" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
              Semaglutide for Weight Loss
            </a>
            <a href="/articles/peptide-bloodwork-guide" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
              Peptide Bloodwork Guide
            </a>
            <a href="/articles/how-to-read-peptide-coa" class="block text-sm text-text-muted hover:text-primary transition-colors leading-snug">
              How to Read a COA
            </a>
          </div>
          <a href="/articles" class="block mt-4 text-xs font-bold text-primary hover:underline">
            View all guides →
          </a>
        </div>

        <!-- Newsletter CTA -->
        <div class="bg-gradient-to-br from-surface-dark to-primary-dark rounded-2xl p-5 text-center">
          <p class="text-sm font-bold text-white mb-2">Stay Informed</p>
          <p class="text-xs text-gray-300 mb-3">Get the latest peptide news and research.</p>
          <a href="/news" class="inline-block px-4 py-2 text-xs font-bold bg-primary text-white rounded-lg hover:bg-primary-light transition-colors">
            Browse All News
          </a>
        </div>
      </div>
    </aside>
  </div>
</Base>
